<div class="github-profile-section section" style="margin: 3em 0; padding: 2em; background: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e9ecef;">
  <div class="section-header section-item">
    <h2 style="text-align: center; color: #2c3e50; margin-bottom: 2em;">
      <i class="fa fa-github"></i> GitHub Profile
    </h2>
  </div>
  
  <!-- GitHub Contributions Chart (Table with Green Squares) -->
  <div class="github-contributions section-item" style="margin-bottom: 3em; text-align: center;">
    <h3 style="color: #2c3e50; margin-bottom: 1.5em; font-size: 1.2em; font-weight: 600;">
      Contribution Activity
    </h3>
    <div style="background: #f8f9fa; padding: 2em; border-radius: 8px; border: 1px solid #e9ecef; overflow-x: auto;">
      <!-- GitHub Contributions Calendar (Green Squares Table) -->
      <div style="display: inline-block; background: white; padding: 1.5em; border-radius: 4px; width: 100%; max-width: 900px;">
        <div id="contributions-chart-container" style="width: 100%; min-height: 200px; display: flex; align-items: center; justify-content: center; position: relative;">
          <div id="chart-loading" style="position: absolute; text-align: center; color: #999;">
            <i class="fa fa-spinner fa-spin" style="font-size: 2em; margin-bottom: 0.5em;"></i>
            <p>Loading contributions chart...</p>
          </div>
          <img 
            id="github-contributions-chart"
            src="" 
            alt="GitHub Contributions Chart"
            style="width: 100%; height: auto; display: none; min-width: 700px; max-width: 100%;"
          />
        </div>
        <p style="margin-top: 1em; font-size: 0.85em; color: #999;">
          <a href="https://github.com/{{ site.github_username }}" target="_blank" style="color: #2c3e50; text-decoration: underline;">
            View full contributions on GitHub
          </a>
        </p>
      </div>
    </div>
  </div>
  
  <script>
  (function() {
    function loadContributionsChart() {
      // Load contributions chart
      const username = '{{ site.github_username }}'.trim();
      if (!username || username === '') {
        return;
      }
      
      const chartImg = document.getElementById('github-contributions-chart');
      const container = document.getElementById('contributions-chart-container');
      
      if (!chartImg || !container) {
        return;
      }
      
      // Try multiple chart services
      const chartServices = [
        `https://ghchart.rshah.org/${username}`,
        `https://github-readme-activity-graph.vercel.app/graph?username=${username}&theme=github`,
        `https://github-contributions-api.deno.dev/${username}.svg`
      ];
      
      let currentService = 0;
      
      function tryNextService() {
        if (currentService < chartServices.length) {
          chartImg.src = chartServices[currentService];
          chartImg.onerror = function() {
            currentService++;
            if (currentService < chartServices.length) {
              tryNextService();
            } else {
              // All services failed, show fallback
              const loading = document.getElementById('chart-loading');
              if (loading) loading.style.display = 'none';
              container.innerHTML = `
                <div style="text-align: center; padding: 2em;">
                  <p style="color: #666; margin-bottom: 1em;">Unable to load contributions chart.</p>
                  <a href="https://github.com/${username}" target="_blank" style="display: inline-block; padding: 0.8em 1.5em; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px;">
                    View on GitHub
                  </a>
                </div>
              `;
            }
          };
          chartImg.onload = function() {
            chartImg.style.display = 'block';
            const loading = document.getElementById('chart-loading');
            if (loading) loading.style.display = 'none';
          };
        }
      }
      
      tryNextService();
    }
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadContributionsChart);
    } else {
      // DOM already ready, but wait a bit for includes to render
      setTimeout(loadContributionsChart, 100);
    }
  })();
  </script>
  
  <div id="github-profile" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5em; margin-bottom: 2em;">
    <!-- Profile stats will be loaded here via JavaScript -->
    <div style="text-align: center;" class="section-item">
      <div style="font-size: 1.5em; margin-bottom: 0.5em; color: #666;">
        <i class="fa fa-spinner fa-spin"></i>
      </div>
      <p style="color: #666;">Loading...</p>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 2em;">
    <a href="https://github.com/{{ site.github_username }}" target="_blank" style="display: inline-block; padding: 0.8em 2em; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px; transition: all 0.3s ease; border: 1px solid #2c3e50;">
      View Full Profile <i class="fa fa-external-link"></i>
    </a>
  </div>
</div>

<script>
(function() {
  // Wait for DOM to be ready
  function initGitHubProfile() {
    const username = '{{ site.github_username }}'.trim();
    if (!username || username === '') {
      console.error('GitHub username not found in config');
      const profileContainer = document.getElementById('github-profile');
      if (profileContainer) {
        profileContainer.innerHTML = `
          <div style="text-align: center; grid-column: 1 / -1; padding: 2em;">
            <p style="font-size: 1em; color: #666;">GitHub username not configured.</p>
          </div>
        `;
      }
      return;
    }
    
    const profileContainer = document.getElementById('github-profile');
    if (!profileContainer) {
      console.error('GitHub profile container not found');
      return;
    }
    
    // Fetch GitHub profile data
    fetch(`https://api.github.com/users/${username}`)
      .then(response => {
        // Handle 403 (rate limit) and other errors gracefully
        if (response.status === 403) {
          profileContainer.innerHTML = `
            <div style="text-align: center; grid-column: 1 / -1; padding: 2em;">
              <p style="font-size: 1em; color: #666; margin-bottom: 0.5em;">GitHub API rate limit reached.</p>
              <a href="https://github.com/${username}" target="_blank" style="display: inline-block; padding: 0.8em 1.5em; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px; margin-top: 0.5em;">
                Visit GitHub Profile <i class="fa fa-external-link"></i>
              </a>
            </div>
          `;
          return null;
        }
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(profile => {
        // If we got null (403 error), stop here
        if (!profile) return;
        
        // Check for API errors
        if (profile.message) {
          if (profile.message.includes('API rate limit') || profile.message.includes('rate limit') || profile.message.includes('403')) {
            profileContainer.innerHTML = `
              <div style="text-align: center; grid-column: 1 / -1; padding: 2em;">
                <p style="font-size: 1em; color: #666; margin-bottom: 0.5em;">GitHub API rate limit reached.</p>
                <a href="https://github.com/${username}" target="_blank" style="display: inline-block; padding: 0.8em 1.5em; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px; margin-top: 0.5em;">
                  Visit GitHub Profile <i class="fa fa-external-link"></i>
                </a>
              </div>
            `;
            return;
          }
          if (profile.message.includes('Not Found')) {
            throw new Error('GitHub user not found');
          }
        }
        
        // Validate profile data
        if (!profile.public_repos && !profile.followers && !profile.following) {
          throw new Error('Invalid profile data received');
        }
        
        const stats = [
          {
            icon: 'fa-code-fork',
            label: 'Repositories',
            value: profile.public_repos || 0
          },
          {
            icon: 'fa-users',
            label: 'Followers',
            value: profile.followers || 0
          },
          {
            icon: 'fa-heart',
            label: 'Following',
            value: profile.following || 0
          }
        ];
        
        let statsHTML = stats.map((stat, index) => `
          <div class="section-item" style="text-align: center; padding: 1.5em; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
            <div style="font-size: 2em; color: #2c3e50; margin-bottom: 0.5em;">
              <i class="fa ${stat.icon}"></i>
            </div>
            <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 0.3em; color: #2c3e50;">${stat.value}</div>
            <div style="font-size: 0.9em; color: #666;">${stat.label}</div>
          </div>
        `).join('');
        
        profileContainer.innerHTML = statsHTML;
        
        // Animate stats after they're loaded
        setTimeout(() => {
          const statsItems = profileContainer.querySelectorAll('.section-item:not(.animate-in)');
          statsItems.forEach((item, idx) => {
            setTimeout(() => {
              item.classList.add('animate-in');
            }, idx * 200);
          });
        }, 200);
      })
      .catch(error => {
        // Only log non-403 errors to console
        if (!error.message || !error.message.includes('403')) {
          console.error('Error fetching GitHub data:', error);
        }
        profileContainer.innerHTML = `
          <div style="text-align: center; grid-column: 1 / -1; padding: 2em;">
            <p style="font-size: 1em; color: #666; margin-bottom: 0.5em;">Unable to load GitHub profile.</p>
            <a href="https://github.com/${username}" target="_blank" style="display: inline-block; padding: 0.8em 1.5em; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px; margin-top: 0.5em;">
              Visit GitHub Profile <i class="fa fa-external-link"></i>
            </a>
          </div>
        `;
      });
  }
  
  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGitHubProfile);
  } else {
    initGitHubProfile();
  }
})();
</script>

